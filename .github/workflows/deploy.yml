name: Deploy Metaflow Flow to Argo
on:
  push:
    branches: [main]

jobs:
  deploy-flow:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      # 3. Install dependencies
      - name: Install Python dependencies
        run: |
          pip install -r requirements.txt
          pip install metaflow[argo] outerbounds[gcp]

      # 4. Configure Kubernetes (if needed)
      # Uncomment and add your kubeconfig setup if cluster requires authentication
      # - name: Set up kubeconfig
      #   run: |
      #     mkdir -p ~/.kube
      #     echo "${{ secrets.KUBECONFIG }}" > ~/.kube/config

      # 5. Deploy flow to Argo Workflows
      - name: Deploy Flow
        run: |
          python deploy.py argo-workflows create